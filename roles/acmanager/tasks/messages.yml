# lobby messages

---

- name: insert motd message for single server
  ansible.builtin.template:
    src: motd.j2
    dest: "{{ acserverPath}}/motd.txt"
    owner: "{{ assetto_user }}"
    group: "{{ assetto_group }}"
    mode: '0644'

- name: insert join message for single server
  ansible.builtin.lineinfile:
    dest: "{{ acmanagerStorePath }}/server_options.json"
    regex: '^  "ServerJoinMessage": '
    line: '  "ServerJoinMessage": "Some, but not all, actions that may get you banned from the server\r\n     *Being disrespectful, insulting or trolling in the chat\r\n     *Intentionally crashing, ramming or blocking other cars on track or in the pits\r\n     *Lack of car control or dangerous driving on track or in the pits\r\n     *Glitching, cheating or intentionally cutting the track (may result in instant ban)\r\n     *Having an unreadable name or one that just reads as “Player” or \"User\"",'
    state: present

- name: insert content manger welcome message
  ansible.builtin.lineinfile:
    dest: "{{ acmanagerStorePath }}/server_options.json"
    regexp: '^  "ContentManagerWelcomeMessage": '
    line: '{% raw %}i  "ContentManagerWelcomeMessage": "\u003cdiv\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003e{{ .ServerName }}\u003c/span\u003e\u0026nbsp;is a casual server for serious drivers.\u003c/div\u003e\u003cdiv\u003eIf you want to take part in the choosing of combos you need to join the discord channel.\u003c/div\u003e\u003cdiv\u003eRules for this SDC server\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;1. Be Respectful\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;2. Follow any instructions from the Moderators\u003c/div\u003e\u003cdiv\u003eSome, but not all, actions that may get you banned from the server\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;*Being disrespectful, insulting or trolling in the chat\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;*Intentionally crashing, ramming or blocking other cars on track or in the pits\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;*Lack of car control or dangerous driving on track or in the pits\u0026nbsp;\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;*Glitching, cheating or intentionally cutting the track (may result in instant ban)\u003c/div\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;*Having an unreadable name or one that just reads as “Player” or \"User\"\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003e{{ .Track }} {{ with .TrackLayout }}({{ . }}){{ end }}\u003c/span\u003e\u003c/p\u003e\u003cp\u003e{{ .EventDescription }}\u003cbr\u003e{{ .ChampionshipPoints }}\u003cbr\u003e{{ .CarDownloads }}\u003cbr\u003e{{ .TrackDownload }}\u003c/p\u003e", {% endraw %}'
    state: present

- name: check if AC multi manager is installed
  ansible.builtin.stat:
    path: "{{ acmanagerPath }}/servers/SERVER_00/" #store.json/server_options.json"
  register: acmm_installed


- name: insert motd message for multi servers
  ansible.builtin.template:
    src: motd.j2
    dest: "{{ acmanagerPath }}/servers/SERVER_{{ item }}/assetto/motd.txt"
    owner: "{{ assetto_user }}"
    group: "{{ assetto_group }}"
    mode: '0644'
  with_sequence: start=0 end={{ acMultiServerManagerCount -1 }} format=%02x
  when: acMultiServerManagerCount > 1 and acmm_installed.stat.exists

- name: insert join message for multi servers
  ansible.builtin.lineinfile:
    dest: "{{ acmanagerPath }}/servers/SERVER_{{ item }}/store.json/server_options.json"
    regex: '^  "ServerJoinMessage": '
    line: '  "ServerJoinMessage": "Some, but not all, actions that may get you banned from the server\r\n     *Being disrespectful, insulting or trolling in the chat\r\n     *Intentionally crashing, ramming or blocking other cars on track or in the pits\r\n     *Lack of car control or dangerous driving on track or in the pits\r\n     *Glitching, cheating or intentionally cutting the track (may result in instant ban)\r\n     *Having an unreadable name or one that just reads as “Player” or \"User\"",'
    state: present
  with_sequence: start=0 end={{ acMultiServerManagerCount -1 }} format=%02x
  when: acMultiServerManagerCount > 1 and acmm_installed.stat.exists

- name: insert content manger welcome messag multi serverse
  ansible.builtin.lineinfile:
    dest: "{{ acmanagerPath }}/servers/SERVER_{{ item }}/store.json/server_options.json"
    regexp: '^  "ContentManagerWelcomeMessage": '
    line: '{% raw %}  "ContentManagerWelcomeMessage": "\u003cdiv\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003e{{ .ServerName }}\u003c/span\u003e\u0026nbsp;is a casual server for serious drivers.\u003c/div\u003e\u003cdiv\u003eIf you want to take part in the choosing of combos you need to join the discord channel.\u003c/div\u003e\u003cdiv\u003eRules for this SDC server\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;1. Be Respectful\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;2. Follow any instructions from the Moderators\u003c/div\u003e\u003cdiv\u003eSome, but not all, actions that may get you banned from the server\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;*Being disrespectful, insulting or trolling in the chat\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;*Intentionally crashing, ramming or blocking other cars on track or in the pits\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;*Lack of car control or dangerous driving on track or in the pits\u0026nbsp;\u003c/div\u003e\u003cdiv\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;*Glitching, cheating or intentionally cutting the track (may result in instant ban)\u003c/div\u003e\u0026nbsp; \u0026nbsp; \u0026nbsp;*Having an unreadable name or one that just reads as “Player” or \"User\"\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003e{{ .Track }} {{ with .TrackLayout }}({{ . }}){{ end }}\u003c/span\u003e\u003c/p\u003e\u003cp\u003e{{ .EventDescription }}\u003cbr\u003e{{ .ChampionshipPoints }}\u003cbr\u003e{{ .CarDownloads }}\u003cbr\u003e{{ .TrackDownload }}\u003c/p\u003e", {% endraw %}'
    state: present
  with_sequence: start=0 end={{ acMultiServerManagerCount -1 }} format=%02x
  when: acMultiServerManagerCount > 1 and acmm_installed.stat.exists
