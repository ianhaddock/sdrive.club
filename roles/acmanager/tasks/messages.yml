# lobby messages
---

- name: insert motd message for single server
  ansible.builtin.template:
    src: motd.j2
    dest: "{{ acserver_path }}/motd.txt"
    owner: "{{ assetto_user }}"
    group: "{{ assetto_group }}"
    mode: '0644'

- name: insert join message for single server
  ansible.builtin.lineinfile:
    dest: "{{ acmanagerStorePath }}/server_options.json"
    regex: '^  "ServerJoinMessage": '
    line: '  "ServerJoinMessage": "Rules for this server:\r\n+ Be Respectful\r\n+ Follow any and all instructions from the Moderators\r\n\r\nSome, but not all, actions that may get you banned from the server:\r\n\r\n+ Being disrespectful, insulting or trolling in the chat\r\n+ Intentionally crashing, ramming or blocking other cars on track or in the pits\r\n+ Lack of car control or dangerous driving on track or in the pits\r\n+ Glitching, cheating or intentionally cutting the track (may result in instant ban)\r\n+ Having an unreadable name or one that just reads as “Player” or \"User\"",'
    state: present

- name: insert content manger welcome message
  ansible.builtin.lineinfile:
    dest: "{{ acmanagerStorePath }}/server_options.json"
    regexp: '^  "ContentManagerWelcomeMessage": '
    line: '{% raw %}  "ContentManagerWelcomeMessage": "\u003cdiv\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003e\u003cbr\u003e\u003c/span\u003e\u003cimg src=\"https://www.sdrive.club/sdc_v4_wide.png\" style=\"width: 930px;\"\u003e\u003c/div\u003e\u003cdiv\u003e\u003cspan style=\"font-family: Impact; font-size: 1rem;\"\u003e\u003cbr\u003e\u003c/span\u003e\u003c/div\u003e\u003cdiv\u003e\u003cspan style=\"font-family: Impact; font-size: 1rem;\"\u003e{{ .ServerName }}\u003c/span\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003eA casual server for serious drivers.\u0026nbsp;\u0026nbsp;\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003eIf you want to take part in the choosing of combos you need to join the discord channel.\u003c/span\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003eRules for this server:\u003c/div\u003e\u003cul\u003e\u003cli\u003eBe Respectful\u003c/li\u003e\u003cli\u003eFollow all instructions from the Moderators\u003c/li\u003e\u003c/ul\u003e\u003cdiv\u003eSome, but not all, actions that may get you banned from the server:\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003eBeing disrespectful, insulting or trolling in the chat\u003c/li\u003e\u003cli\u003eIntentionally crashing, ramming or blocking other cars\u003c/li\u003e\u003cli\u003eLack of car control or dangerous driving on track or in the pits\u0026nbsp;\u003c/li\u003e\u003cli\u003eGlitching, cheating or intentionally cutting the track\u003c/li\u003e\u003cli\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;;\"\u003eUnreadable names or just “Player” or \"User\"\u003c/span\u003e\u003c/li\u003e\u003c/ul\u003e\u003cdiv\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003e{{ .Track }} {{ with .TrackLayout }}({{ . }}){{ end }}\u003c/span\u003e\u003cbr\u003e\u003c/div\u003e\u003cp\u003e{{ .EventDescription }}\u003cbr\u003e{{ .ChampionshipPoints }}\u003cbr\u003e{{ .CarDownloads }}\u003cbr\u003e{{ .TrackDownload }}\u003c/p\u003e", {% endraw %}'
    state: present

- name: check if AC multi manager is installed
  ansible.builtin.stat:
    path: "{{ acmanager_path }}/servers/SERVER_00/" #store.json/server_options.json"
  register: acmm_installed

- name: insert motd message for multi servers
  ansible.builtin.template:
    src: motd.j2
    dest: "{{ acmanager_path }}/servers/SERVER_{{ item }}/assetto/motd.txt"
    owner: "{{ assetto_user }}"
    group: "{{ assetto_group }}"
    mode: '0644'
  with_sequence: start=0 end={{ server_count -1 }} format=%02x
  when: server_count > 1 and acmm_installed.stat.exists

- name: insert join message for multi servers
  ansible.builtin.lineinfile:
    dest: "{{ acmanager_path }}/servers/SERVER_{{ item }}/store.json/server_options.json"
    regex: '^  "ServerJoinMessage": '
    line: '  "ServerJoinMessage": "Rules for this server:\r\n+ Be Respectful\r\n+ Follow any and all instructions from the Moderators\r\n\r\nSome, but not all, actions that may get you banned from the server:\r\n\r\n+ Being disrespectful, insulting or trolling in the chat\r\n+ Intentionally crashing, ramming or blocking other cars on track or in the pits\r\n+ Lack of car control or dangerous driving on track or in the pits\r\n+ Glitching, cheating or intentionally cutting the track (may result in instant ban)\r\n+ Having an unreadable name or one that just reads as “Player” or \"User\"",'
    state: present
  with_sequence: start=0 end={{ server_count -1 }} format=%02x
  when: server_count > 1 and acmm_installed.stat.exists

- name: insert content manger welcome messag multi serverse
  ansible.builtin.lineinfile:
    dest: "{{ acmanager_path }}/servers/SERVER_{{ item }}/store.json/server_options.json"
    regexp: '^  "ContentManagerWelcomeMessage": '
    line: '{% raw %}  "ContentManagerWelcomeMessage": "\u003cdiv\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003e\u003cbr\u003e\u003c/span\u003e\u003cimg src=\"https://www.sdrive.club/sdc_v4_wide.png\" style=\"width: 930px;\"\u003e\u003c/div\u003e\u003cdiv\u003e\u003cspan style=\"font-family: Impact; font-size: 1rem;\"\u003e\u003cbr\u003e\u003c/span\u003e\u003c/div\u003e\u003cdiv\u003e\u003cspan style=\"font-family: Impact; font-size: 1rem;\"\u003e{{ .ServerName }}\u003c/span\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003eA casual server for serious drivers.\u0026nbsp;\u0026nbsp;\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003eIf you want to take part in the choosing of combos you need to join the discord channel.\u003c/span\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003eRules for this server:\u003c/div\u003e\u003cul\u003e\u003cli\u003eBe Respectful\u003c/li\u003e\u003cli\u003eFollow all instructions from the Moderators\u003c/li\u003e\u003c/ul\u003e\u003cdiv\u003eSome, but not all, actions that may get you banned from the server:\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003eBeing disrespectful, insulting or trolling in the chat\u003c/li\u003e\u003cli\u003eIntentionally crashing, ramming or blocking other cars\u003c/li\u003e\u003cli\u003eLack of car control or dangerous driving on track or in the pits\u0026nbsp;\u003c/li\u003e\u003cli\u003eGlitching, cheating or intentionally cutting the track\u003c/li\u003e\u003cli\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;;\"\u003eUnreadable names or just “Player” or \"User\"\u003c/span\u003e\u003c/li\u003e\u003c/ul\u003e\u003cdiv\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003e{{ .Track }} {{ with .TrackLayout }}({{ . }}){{ end }}\u003c/span\u003e\u003cbr\u003e\u003c/div\u003e\u003cp\u003e{{ .EventDescription }}\u003cbr\u003e{{ .ChampionshipPoints }}\u003cbr\u003e{{ .CarDownloads }}\u003cbr\u003e{{ .TrackDownload }}\u003c/p\u003e", {% endraw %}'
    state: present
  with_sequence: start=0 end={{ server_count -1 }} format=%02x
  when: server_count > 1 and acmm_installed.stat.exists
