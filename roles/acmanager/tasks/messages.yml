# lobby messages
---

- name: insert motd message for single server
  ansible.builtin.template:
    src: motd.j2
    dest: "{{ acserver_path }}/motd.txt"
    owner: "{{ assetto_user }}"
    group: "{{ assetto_group }}"
    mode: '0644'
  when: server_count == 1

- name: insert join message for single server
  ansible.builtin.lineinfile:
    dest: "{{ acmanagerStorePath }}/server_options.json"
    regex: '^  "ServerJoinMessage": '
    line: '  "ServerJoinMessage": "",'
    state: present

- name: insert content manger welcome message
  ansible.builtin.lineinfile:
    dest: "{{ acmanagerStorePath }}/server_options.json"
    regexp: '^  "ContentManagerWelcomeMessage": '
    line: '{% raw %}  "ContentManagerWelcomeMessage": "\u003cdiv\u003e\u003cimg src=\"https://www.sdrive.club/sdc_v4_banner_v1.png\" style=\"width: 930px;\"\u003e\u003c/div\u003e\u003cdiv\u003e\u003cspan style=\"font-family: Impact; font-size: 1rem;\"\u003e\u003cbr\u003e\u003c/span\u003e\u003c/div\u003e\u003cdiv\u003e\u003cspan style=\"font-family: Impact; font-size: 1rem;\"\u003e{{ .ServerName }}\u003c/span\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003eA casual server for serious drivers.\u0026nbsp; Join the Discord channel to\u0026nbsp;\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003etake part in the choosing of combos!\u003c/span\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003e\u003cb\u003eRules for this server:\u003c/b\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003eBe Respectful\u003c/li\u003e\u003cli\u003eFollow all instructions from the Moderators\u003c/li\u003e\u003c/ul\u003e\u003cdiv\u003e\u003cb\u003eBannable offenses:\u003c/b\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003eBeing disrespectful, offensive, or insulting in chat\u003c/li\u003e\u003cli\u003eIntentionally crashing, ramming or blocking\u003c/li\u003e\u003cli\u003eLack of car control, dangerous driving on track or pits\u0026nbsp;\u003c/li\u003e\u003cli\u003eGlitching, cheating or intentionally track cutting\u003c/li\u003e\u003cli\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;;\"\u003eNames that are unreadable, or “Player” \u0026amp; \"User\"\u003c/span\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e{{ .CarDownloads }}\u003cbr\u003e{{ .TrackDownload }}\u003c/p\u003e\u003cp\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003eBy joining you accept our \u003c/span\u003e\u003ca href=\"https://sdrive.club/tos\" target=\"_blank\" style=\"background-color: rgb(255, 255, 255); font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003eterms of service\u003c/a\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003e.\u003c/span\u003e\u003cbr\u003e\u003c/p\u003e", {% endraw %}'
    state: present

- name: check if AC multi manager is installed
  ansible.builtin.stat:
    path: "{{ acmanager_path }}/servers/SERVER_00/" #store.json/server_options.json"
  register: acmm_installed

- name: insert motd message for multi servers
  ansible.builtin.template:
    src: motd.j2
    dest: "{{ acmanager_path }}/servers/SERVER_{{ item }}/assetto/motd.txt"
    owner: "{{ assetto_user }}"
    group: "{{ assetto_group }}"
    mode: '0644'
  with_sequence: start=0 end={{ server_count -1 }} format=%02x
  when: server_count > 1 and acmm_installed.stat.exists

- name: insert join message for multi servers
  ansible.builtin.lineinfile:
    dest: "{{ acmanager_path }}/servers/SERVER_{{ item }}/store.json/server_options.json"
    regex: '^  "ServerJoinMessage": '
    line: '  "ServerJoinMessage": "",'
    state: present
  with_sequence: start=0 end={{ server_count -1 }} format=%02x
  when: server_count > 1 and acmm_installed.stat.exists

- name: insert content manger welcome messag multi serverse
  ansible.builtin.lineinfile:
    dest: "{{ acmanager_path }}/servers/SERVER_{{ item }}/store.json/server_options.json"
    regexp: '^  "ContentManagerWelcomeMessage": '
    line: '{% raw %}  "ContentManagerWelcomeMessage": "\u003cdiv\u003e\u003cimg src=\"https://www.sdrive.club/sdc_v4_banner_v1.png\" style=\"width: 930px;\"\u003e\u003c/div\u003e\u003cdiv\u003e\u003cspan style=\"font-family: Impact; font-size: 1rem;\"\u003e\u003cbr\u003e\u003c/span\u003e\u003c/div\u003e\u003cdiv\u003e\u003cspan style=\"font-family: Impact; font-size: 1rem;\"\u003e{{ .ServerName }}\u003c/span\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003eA casual server for serious drivers.\u0026nbsp; Join the Discord channel to\u0026nbsp;\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003etake part in the choosing of combos!\u003c/span\u003e\u003c/div\u003e\u003cdiv\u003e\u003cbr\u003e\u003c/div\u003e\u003cdiv\u003e\u003cb\u003eRules for this server:\u003c/b\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003eBe Respectful\u003c/li\u003e\u003cli\u003eFollow all instructions from the Moderators\u003c/li\u003e\u003c/ul\u003e\u003cdiv\u003e\u003cb\u003eBannable offenses:\u003c/b\u003e\u003c/div\u003e\u003cul\u003e\u003cli\u003eBeing disrespectful, offensive, or insulting in chat\u003c/li\u003e\u003cli\u003eIntentionally crashing, ramming or blocking\u003c/li\u003e\u003cli\u003eLack of car control, dangerous driving on track or pits\u0026nbsp;\u003c/li\u003e\u003cli\u003eGlitching, cheating or intentionally track cutting\u003c/li\u003e\u003cli\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;;\"\u003eNames that are unreadable, or “Player” \u0026amp; \"User\"\u003c/span\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003e{{ .CarDownloads }}\u003cbr\u003e{{ .TrackDownload }}\u003c/p\u003e\u003cp\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003eBy joining you accept our \u003c/span\u003e\u003ca href=\"https://sdrive.club/tos\" target=\"_blank\" style=\"background-color: rgb(255, 255, 255); font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003eterms of service\u003c/a\u003e\u003cspan style=\"font-family: \u0026quot;Source Sans Pro\u0026quot;, -apple-system, BlinkMacSystemFont, \u0026quot;Segoe UI\u0026quot;, Roboto, \u0026quot;Helvetica Neue\u0026quot;, Arial, sans-serif, \u0026quot;Apple Color Emoji\u0026quot;, \u0026quot;Segoe UI Emoji\u0026quot;, \u0026quot;Segoe UI Symbol\u0026quot;; font-size: 1rem;\"\u003e.\u003c/span\u003e\u003cbr\u003e\u003c/p\u003e", {% endraw %}'
    state: present
  with_sequence: start=0 end={{ server_count -1 }} format=%02x
  when: server_count > 1 and acmm_installed.stat.exists
